<!-- templates/search.html -->
<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <title>Demo Buscador</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Estilos rápidos con Bootstrap CDN -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    >
  </head>
  <body>
    <div class="container py-4">
      <h1 class="mb-4">Demo Buscador</h1>

      <form method="get" class="mb-4">
        <!-- Búsqueda por palabras clave -->
        <div class="mb-3">
          <label for="q" class="form-label">Palabras clave</label>
          <input
            type="text"
            id="q"
            name="q"
            class="form-control"
            placeholder="Buscar por radicado, título o texto del laudo…"
            value="{{ q }}"
          >
        </div>

        <!-- Filtros por etiquetas -->
        <div class="mb-3">
          <label class="form-label">Filtrar por etiquetas</label>
          <div class="d-flex flex-wrap">
            {% for tag in tags %}
              <div class="form-check me-3 mb-1">
                <input
                  class="form-check-input"
                  type="checkbox"
                  name="tag"
                  id="tag-{{ tag.id }}"
                  value="{{ tag.id }}"
                  {% if tag.id in selected_tag_ids %}checked{% endif %}
                >
                <label class="form-check-label" for="tag-{{ tag.id }}">
                  {{ tag.name }}
                </label>
              </div>
            {% endfor %}
          </div>
        </div>

        <button type="submit" class="btn btn-primary">
          Buscar
        </button>
      </form>

      <hr>

      <h2 class="h5 mb-3">Resultados ({{ results|length }})</h2>

      {% if results %}
        <ul class="list-group">
          {% for case in results %}
            <li class="list-group-item">
              <div class="d-flex justify-content-between align-items-start">
                <div class="me-3">
                  <!-- Radicado y fecha del laudo -->
                  <p class="mb-1 small text-muted">
                    <strong>Radicado:</strong> {{ case.radicado }}
                    {% if case.fecha_laudo %}
                      · <strong>Laudo:</strong>
                      {{ case.fecha_laudo.strftime('%d/%m/%Y') }}
                    {% endif %}
                  </p>

                  <h3 class="h6 mb-1">{{ case.title }}</h3>

                  <p class="mb-1 small text-muted">
                    {% for tag in case.tags %}
                      <span class="badge text-bg-secondary">{{ tag.name }}</span>
                    {% endfor %}
                  </p>

                  <p class="mb-0">
                    {{ case.content[:220] }}{% if case.content|length > 220 %}…{% endif %}
                  </p>
                </div>

                {% if case.doc_filename %}
                  <div class="text-nowrap">
                    <a
                      href="{{ url_for('download_case', case_id=case.id) }}"
                      class="btn btn-sm btn-outline-secondary"
                    >
                      Descargar documento
                    </a>
                  </div>
                {% endif %}
              </div>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p class="text-muted">No se encontraron casos que cumplan con los criterios de búsqueda.</p>
      {% endif %}
    </div>
  </body>
</html>
